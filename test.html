<form id="signupForm">
  <input type="text" name="emailAddress" required>
  <input type="text" name="username" required>
  <input type="password" name="password" required>
  <button id="submitBtn" type="submit">Submit</button>
</form>

<div id="status"></div>

<form id="loginForm">
  <input type="text" name="identifier" required>
  <input type="password" name="password" required>
  <button id="submitBtn2" type="submit">Submit</button>
</form>

<script>
const form = document.getElementById('signupForm');
const loginForm = document.getElementById('loginForm');
const statusEl = document.getElementById('status');
const submitBtn = document.getElementById('submitBtn');
const loginSubmitBtn = document.getElementById('submitBtn2');

form.addEventListener('submit', async (e) => {
  e.preventDefault(); // STOP the default refresh

  // simple UX: disable button while request runs
  submitBtn.disabled = true;
  statusEl.textContent = 'Sending...';

  const data = {
    emailAddress: form.emailAddress.value,
    username: form.username.value,
    password: form.password.value
  };

  try {
    const res = await fetch('http://localhost:3000/signup', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    // Parse based on response content-type (try json, fallback to text)
    let payload;
    const ct = res.headers.get('content-type') || '';
    if (ct.includes('application/json')) payload = await res.json();
    else payload = await res.text();

    if (!res.ok) {
      statusEl.textContent = 'Error: ' + (payload.error || payload || res.status);
    } else {
      statusEl.textContent = '✅ Signup successful';
      console.log('Server response:', payload);
      // optionally reset form: form.reset();
    }
  } catch (err) {
    console.error('Network/fetch error', err);
    statusEl.textContent = 'Network error';
  } finally {
    submitBtn.disabled = false;
  }
});

loginForm.addEventListener('submit', async (e) => {
  e.preventDefault(); // STOP the default refresh

  // simple UX: disable button while request runs
  submitBtn.disabled = true;
  statusEl.textContent = 'Sending...';

  const data = {
    identifier: loginForm.identifier.value,
    password: loginForm.password.value
  };

  try {
    const res = await fetch('http://localhost:3000/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    // Parse based on response content-type (try json, fallback to text)
    let payload;
    const ct = res.headers.get('content-type') || '';
    if (ct.includes('application/json')) payload = await res.json();
    else payload = await res.text();

    if (!res.ok) {
      statusEl.textContent = 'Error: ' + (payload.error || payload || res.status);
    } else {
      statusEl.textContent = '✅ Log in successful';
      console.log('Server response:', payload);
      // optionally reset form: form.reset();
    }
  } catch (err) {
    console.error('Network/fetch error', err);
    statusEl.textContent = 'Network error';
  } finally {
    submitBtn.disabled = false;
  }
});
</script>
